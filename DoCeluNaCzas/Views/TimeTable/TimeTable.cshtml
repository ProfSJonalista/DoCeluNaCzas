@model DCNC.Bussiness.Models.MinuteTimeTable

<div id="Timetable" class="tabcontent">



    @foreach (var day in Model.MinuteDictionary)
    {
        <div class="week-name">
            @if (day.Key.ToString() == "Weekday")
            {
                <text>
                    Dni powszednie
                </text>
            }

            @if (day.Key.ToString() == "Saturday")
            {
                <text>
                    Soboty
                </text>
            }

            @if (day.Key.ToString() == "Sunday")
            {
                <text>
                    Niedziele i święta
                </text>
            }


        </div>
        foreach (var list in day.Value)
        {
            <text>
                <table class="timetable-table" id="timetableTable">
                    <tr class="row-content">
                        <td class="hours">
                            @list.Key
                        </td>

                        @foreach (var minute in list.Value)
                        {
                            <td class="minutes">
                                @minute
                            </td>
                        }
                    </tr>
                </table>
            </text>
        }
    }


</div>





<!--Script references. -->
<!--Reference the jQuery library. -->
<!--<script src="/Scripts/jquery-1.6.4.min.js" "></script>-->
<!--Reference the SignalR library. -->
<!--<!--<script src="/Scripts/jquery.signalR-2.4.1.min.js"></script>-->
<!--Reference the autogenerated SignalR hub script. -->
<!--<script src="~/signalr/hubs"></script>-->
<script type="text/javascript">
    function Connect() {
        $.getScript('http://docelunaczaswebapi.com/Scripts/jquery.signalR-2.4.0.min.js', function () {
            $.getScript('http://docelunaczaswebapi.com/signalr/hubs', function () {
                //$.connection.hub.url = 'http://docelunaczaswebapi.com/signalr';
                //var myHub = $.connection.delaysHub;
                //ChatProxy = SignalrConnection.createHubProxy('ChatHub');

                var url = 'http://docelunaczaswebapi.com/signalr';
                //This will hold the connection to the signalr hub
                SignalrConnection = $.hubConnection(url, {
                    useDefaultPath: false
                });
                delaysProxy = SignalrConnection.createHubProxy('DelaysHub');
                SignalrConnection.getDelays = function (StopId) { };
                delaysProxy.server.getDelays = function (StopId) { };

                //DelaysProxy.on("GetDelays", function (stopId) {
                //    $('span').text(stopId);
                //}); 

                //$.connection.hub.start({ withCredentials: false }).done(function () {
                SignalrConnection.start({ withCredentials: false }).done(function () {
                    //alert("Connected to Signalr Server");
                    //})
                    //.fail(function () {
                    //    alert("failed in connecting to the signalr server");
                    //})

                    var res = delaysProxy.server.getDelays(1637);
                    alert(res);

                    //DelaysProxy.invoke('getDelays', 30139);
                });


            });
        });
    }

    function GetDelays() {

        //calling the ChangeWeather function on the signalr server
        var StopId = document.getElementById('txtTemperature').value;
        //var res = DelaysProxy.invoke('getDelays', StopId);
        var res = delaysProxy.server.getDelays(StopId);
        alert(res);

        //var res = DelaysProxy.server.GetDelays(StopId);
        
        //var resArr = res.ToArray();
        console.log(JSON.stringify(res));
        //alert(JSON.stringify(res));
        //console.log(Object.keys(res));
        //var resO = (Object)res;
        
    }

   

</script>



<body onload="Connect();">
    <div style="text-align:center;">
        <input type="text" id="txtTemperature" />
        <button id="btnChange" onclick="GetDelays();">GetDelays</button>
    </div>
</body>

<div style="text-align:center;">
    Delays : <span></span>
</div>